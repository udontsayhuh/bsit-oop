using System;

namespace My_Colorful_Calculator
{
    // Interface of my calculator
    interface ICalculator
    {
        float Calculate(float num1, float num2, string operation);
    }

    // Calculations of basic arithmetic operations
    class BasicCalculator : ICalculator
    {
        public float Calculate(float num1, float num2, string operation)
        {
            switch (operation)
            {
                case "+":
                    return num1 + num2;
                case "-":
                    return num1 - num2;
                case "*":
                    return num1 * num2;
                case "/":
                    if (num2 != 0)
                        return num1 / num2;
                    else
                        throw new DivideByZeroException("Error: Division by zero!");
                default:
                    throw new ArgumentException("Invalid operation!");
            }
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            // Title and Text Color
            Console.Title = "Marv's Calculator";
            Console.ForegroundColor = ConsoleColor.Cyan;

            // Loop to calculate again
            bool calculateAgain = true;

            // Main loop for calculator
            while (calculateAgain)
            {
                // Start of calculation process
                Console.WriteLine("START CALCULATING:");

                // Input first number
                float num1 = GetValidNumber("Enter a number: ");

                // Input the operator or '=' to calculate
                string currentOperator = GetValidOperator("Enter the operator (+, -, *, /) or '=' to calculate: ");

                ICalculator calculator = new BasicCalculator(); // Dependency Inversion: Depend on abstraction, not concrete implementation

                // Loop to input numbers and operators until '=' is entered
                while (currentOperator != "=")
                {
                    // Input next number
                    float num2 = GetValidNumber("Enter a number: ");

                    // Calculate based on current operator
                    num1 = calculator.Calculate(num1, num2, currentOperator); // Liskov Substitution: BasicCalculator implements ICalculator interface

                    // Input the next operator or '=' to calculate
                    currentOperator = GetValidOperator("Enter the operator (+, -, *, /) or '=' to calculate: ");
                }

                // Output the result
                Console.ForegroundColor = ConsoleColor.Green;
                Console.WriteLine($"Result: {num1}");

                // Ask user to calculate again
                Console.ForegroundColor = ConsoleColor.Cyan;
                Console.Write("Do you want to calculate again? (yes/no): ");
                string choice = Console.ReadLine().ToLower();

                // Exit loop if 'no' is entered
                if (choice != "yes")
                    calculateAgain = false;
            }

            // Just a closing message
            Console.ForegroundColor = ConsoleColor.White;
            Console.WriteLine("Thank you for using Marv's Calculator!");
            Console.ReadKey();
        }

        // Method to get a valid number input from the user
        static float GetValidNumber(string message)
        {
            float number;
            while (true)
            {
                Console.Write(message);
                if (float.TryParse(Console.ReadLine(), out number))
                    break;
                else
                {
                    Console.ForegroundColor = ConsoleColor.Red;
                    Console.WriteLine("Invalid input! Please enter a valid number.");
                    Console.ForegroundColor = ConsoleColor.Cyan;
                }
            }
            return number;
        }

        // Method to get a valid operator input from the user
        static string GetValidOperator(string message)
        {
            string op;
            while (true)
            {
                Console.Write(message);
                op = Console.ReadLine();
                if (op == "+" || op == "-" || op == "*" || op == "/" || op == "=")
                    break;
                else
                {
                    Console.ForegroundColor = ConsoleColor.Red;
                    Console.WriteLine("Invalid operator! Please enter a valid operator or '='.");
                    Console.ForegroundColor = ConsoleColor.Cyan;
                }
            }
            return op;
        }
    }
}
